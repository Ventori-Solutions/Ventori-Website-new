---
import BaseLayout from "../layouts/BaseLayout.astro";
import Header from "../components/Header.astro";
import Footer from "../components/Footer.astro";
import Accordion from "../components/Accordion.astro";
import { serviceCategories } from "../content/services";
import "../styles/services.css";
---
<BaseLayout title="Ventori Services â€“ Explore Our Offerings" description="From foundational training to full AI implementation, discover how Ventori Data Solutions can accelerate your AI & automation journey.">
  <Header />
  <main>
    <section class="services-hero">
      <div class="container">
        <h1 class="h1">Explore Our Services</h1>
        <p class="lead muted">
          From foundational training to full AI implementation, discover how Ventori Data Solutions can accelerate your AI & automation journey.
        </p>
      </div>
    </section>

    <section class="services-overview">
      <div class="container">
        <div class="services-tabs" role="tablist">
          {serviceCategories.map((category, index) => (
            <button
              id={`tab-${category.id}`}
              class={`services-tab${index === 0 ? ' active' : ''}`}
              type="button"
              role="tab"
              aria-selected={index === 0 ? 'true' : 'false'}
              aria-controls={category.id}
              tabindex={index === 0 ? '0' : '-1'}
            >
              {category.title}
            </button>
          ))}
        </div>

        {serviceCategories.map((category, index) => (
          <div
            id={category.id}
            class="category-panel"
            role="tabpanel"
            aria-labelledby={`tab-${category.id}`}
            hidden={index !== 0}
          >
            <div class="accordion-group">
              {category.items.map(item => (
                <Accordion title={item.title} initiallyOpen={item.initiallyOpen}>
                  <p class="muted">{item.description}</p>
                </Accordion>
              ))}
            </div>
          </div>
        ))}
      </div>
    </section>
  </main>
  <Footer />

  <script client:load>
    const tabs = Array.from(document.querySelectorAll('.services-tab'));
    const panels = Array.from(document.querySelectorAll('.category-panel'));

    function activateTab(tab) {
      const targetId = tab.getAttribute('aria-controls');
      tabs.forEach(t => {
        const selected = t === tab;
        t.classList.toggle('active', selected);
        t.setAttribute('aria-selected', selected);
        t.setAttribute('tabindex', selected ? '0' : '-1');
      });
      panels.forEach(panel => {
        panel.toggleAttribute('hidden', panel.id !== targetId);
      });
      tab.focus();
    }

    tabs.forEach(tab => {
      tab.addEventListener('click', () => activateTab(tab));
      tab.addEventListener('keydown', e => {
        if (e.key === 'ArrowRight' || e.key === 'ArrowLeft') {
          e.preventDefault();
          const dir = e.key === 'ArrowRight' ? 1 : -1;
          const idx = tabs.indexOf(tab);
          const next = tabs[(idx + dir + tabs.length) % tabs.length];
          activateTab(next);
        }
      });
    });

    document.querySelectorAll('.accordion-group').forEach(group => {
      const accordions = Array.from(group.querySelectorAll('.accordion'));
      const closeAcc = acc => {
        acc.classList.remove('open');
        const btn = acc.querySelector('.accordion-button');
        const content = acc.querySelector('.accordion-content');
        if (btn) btn.setAttribute('aria-expanded', 'false');
        if (content) content.style.maxHeight = 0;
      };
      const openAcc = acc => {
        acc.classList.add('open');
        const btn = acc.querySelector('.accordion-button');
        const content = acc.querySelector('.accordion-content');
        if (btn) btn.setAttribute('aria-expanded', 'true');
        if (content) content.style.maxHeight = content.scrollHeight + 'px';
      };
      accordions.forEach(acc => {
        const btn = acc.querySelector('.accordion-button');
        const content = acc.querySelector('.accordion-content');
        if (acc.classList.contains('open') && content) {
          content.style.maxHeight = content.scrollHeight + 'px';
        }
        btn?.addEventListener('click', () => {
          const isOpen = acc.classList.contains('open');
          accordions.forEach(closeAcc);
          if (!isOpen) openAcc(acc);
        });
      });
    });

    window.addEventListener('resize', () => {
      document.querySelectorAll('.accordion.open .accordion-content').forEach(c => {
        c.style.maxHeight = c.scrollHeight + 'px';
      });
    });
  </script>
</BaseLayout>
